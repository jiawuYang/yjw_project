
日期 | 版本号 | 版本内容 | 作者 | 审核 | 备注
---|---|---|---|---|---
2019-08-27 | v0.1 | 初版 | 孙隆 | |
2019-08-27 | v0.2 | 增加设置BaseX时间的指令 | 孙隆 | |
2020-05-18 | v0.3 | 增加广播开/关指令 | 孙隆 | |

# 文档目标

- 描述TXAir与BaseX之间电量通信的方式


# 协议格式

帧头 | 长度 | 指令 | 数据 | 校验
---|---|---|---|---
0xFF 0x55 | 1字节 | 1字节 | N字节 | 1字节

说明：
- 数据长度 ： 数据的长度，不含校验
- 校验 ： 所有数据异或后得到的值


# 指令表

指令 | 功能
---|---
0x00 | BaseX查询TXAir当前电量等级
0x01 | BaseX通知TXAir开始充电的时间戳
0x02 | BaseX通知TXAir结束充电的时间戳
0x03 | 用户设定BaseX当前时间
0x04 | 启动/关闭 TXAir广播功能 


# 功能说明

## 1. 查询电量等级

说明：设备返回当前的电压等级（百分比）

发送： BaseX -> TXAir

帧头 | 数据长度 | 指令 | 数据 | 异或校验
---|---|---|---|---
0xFF 0x55 | 0x00 | 0x00 | 无 | xx

返回: TXAir -> BaseX

帧头 | 数据长度 | 指令 | 数据 | 异或校验
---|---|---|---|---
0xFF 0x55 | 0x01 | 0x00 | 电量百分比 | xx

示例：查询当前电量，TXAir当前电量为100%
- 发送 ： FF 55 00 00 AA
- 返回 ： FF 55 01 00 64 XX


## 2. 通知TXAir开始充电

说明：

发送：BaseX -> TXAir

帧头 | 数据长度 | 指令 | 数据 | 异或校验
---|---|---|---|---
0xFF 0x55 | 0x04 | 0x01 | UTC时间戳 | xx

返回：TXAir -> BaseX

帧头 | 数据长度 | 指令 | 数据 | 异或校验
---|---|---|---|---
0xFF 0x55 | 0x00 | 0x01 | 无 | xx

示例：开始充电时间为“Tue Aug 27 16:22:47 CST 2019”
（UTC Timestamp 1566894167 = 0x5D64E857）
- 发送：FF 55 04 01 5D 64 E8 57 xx
- 返回：FF 55 00 01 XX


## 3. 通知TXAir结束充电

说明：

发送：BaseX -> TXAir

帧头 | 数据长度 | 指令 | 数据 | 异或校验
---|---|---|---|---
0xFF 0x55 | 0x04 | 0x02 | UTC时间戳 | xx

返回：TXAir -> BaseX

帧头 | 数据长度 | 指令 | 数据 | 异或校验
---|---|---|---|---
0xFF 0x55 | 0x00 | 0x02 | 无 | xx

示例：结束充电时间为“Tue Aug 27 16:22:47 CST 2019”
（UTC Timestamp 1566894167 = 0x5D64E857）
- 发送：FF 55 04 02 5D 64 E8 57 xx
- 返回：FF 55 00 02 XX

## 4. 设定当前时间

说明：用户设定当前本地时间到BaseX

发送：ATS设置工具 -> BaseX

帧头 | 数据长度 | 指令 | 数据 | 异或校验
---|---|---|---|---
0xFF 0x55 | 0x08 | 0x03 | 当前本地时间 | xx

数据 | 数据类型 | 长度
---|---|---
时区 | uint8 | 1字节
年 | uint16 | 2字节
月 | uint8 | 1字节
日 | uint8 | 1字节
时 | uint8 | 1字节
分 | uint8 | 1字节
秒 | uint8 | 1字节

返回：BaseX -> ATS设置工具

帧头 | 数据长度 | 指令 | 数据 | 异或校验
---|---|---|---|---
0xFF 0x55 | 0x00 | 0x03 | 无 | xx

示例：当前时间为 北京时间 Tue Aug 27 16:22:47 CST 2019
- 发送：FF 55 08 03 08 07 E3 08 1B 10 16 2F XX
- 返回：FF 55 00 03 XX

（说明：时区为0~24，对应十六进制为0x00~0x18
1~12为西时区：0x01~0x0c
13~24为东时区：0x0d~0x18
示例：北京时间为东八区，即20（0x14）
）



## 5. 通知TXAir打开或关闭广播

说明：

发送：BaseX -> TXAir

| 帧头      | 数据长度 | 指令 | 数据                | 异或校验 |
| --------- | -------- | ---- | ------------------- | -------- |
| 0xFF 0x55 | 0x01     | 0x05 | 广播开/关标识 1字节 | xx       |

返回：TXAir -> BaseX

| 帧头      | 数据长度 | 指令 | 数据 | 异或校验 |
| --------- | -------- | ---- | ---- | -------- |
| 0xFF 0x55 | 0x00     | 0x05 | 无   | xx       |

- 打开广播：FF 55 01 05 01 xx
- 关闭广播：FF 55 01 05 00 xx
- 返回：FF 55 00 05 XX